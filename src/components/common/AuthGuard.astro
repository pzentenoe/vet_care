---
import { isAuthenticated } from '@stores/authStore';
---

<div id="auth-guard">
    <div id="loading-screen" class="flex items-center justify-center min-h-screen">
        <div class="text-center">
            <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mb-4"></div>
            <p class="text-gray-600">Cargando...</p>
        </div>
    </div>
    
    <div id="auth-content" class="hidden">
        <slot />
    </div>
    
    <div id="unauthorized-screen" class="hidden min-h-screen flex flex-col items-center justify-center p-4">
        <div class="text-center max-w-md">
            <i class="fas fa-lock text-5xl text-gray-400 mb-4"></i>
            <h1 class="text-2xl font-bold text-gray-800 mb-2">Acceso restringido</h1>
            <p class="text-gray-600 mb-6">Necesitas iniciar sesión para acceder a esta página.</p>
            <button id="login-redirect-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition duration-300">
                Iniciar sesión
            </button>
        </div>
    </div>
</div>

<script>
import { isAuthenticated } from '@stores/authStore';

document.addEventListener('DOMContentLoaded', () => {
    const loadingScreen = document.getElementById('loading-screen');
    const authContent = document.getElementById('auth-content');
    const unauthorizedScreen = document.getElementById('unauthorized-screen');
    
    // Verificar autenticación
    if (isAuthenticated.get()) {
        // Usuario autenticado, mostrar contenido
        loadingScreen?.classList.add('hidden');
        authContent?.classList.remove('hidden');
    } else {
        // Usuario no autenticado, mostrar pantalla de no autorizado
        loadingScreen?.classList.add('hidden');
        unauthorizedScreen?.classList.remove('hidden');
        
        // Configurar botón de redirección a login
        const loginButton = document.getElementById('login-redirect-button');
        loginButton?.addEventListener('click', () => {
            // Abrimos el modal de login
            const openLoginModal = window.openLoginModal;
            if (typeof openLoginModal === 'function') {
                openLoginModal();
            } else {
                // Fallback si la función no está disponible
                window.location.href = '/';
            }
        });
    }
    
    // Observar cambios en la autenticación
    isAuthenticated.subscribe((isAuth) => {
        if (isAuth) {
            loadingScreen?.classList.add('hidden');
            unauthorizedScreen?.classList.add('hidden');
            authContent?.classList.remove('hidden');
        } else {
            loadingScreen?.classList.add('hidden');
            authContent?.classList.add('hidden');
            unauthorizedScreen?.classList.remove('hidden');
        }
    });
});
</script>